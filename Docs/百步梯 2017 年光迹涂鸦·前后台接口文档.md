# 百步梯 2017 年光迹涂鸦·前后台接口文档

## 后端接口全局返回模板

```
{
  "type": "object",
  "oneOf": [
    {
      "properties": {
        "status": { "enum": [ 0 ] },
        "data": {
          "type": "object"
        }
      },
      "required": ["status", "data"]
    },
    {
      "properties": {
        "status": { "type": "", "not": { "enum": [ 0 ] } },
        "errorMessage": {"type": "string" }
      },
      "required": ["status", "errorMessage"]
    }
  ]
}
```

### 示例

成功：

```
{
	"status": 0,
	"data": {}
}
```

`data` 即为下文所示后端返回数据

异常:

```
{
	"status": 1,
	"errorMessage": "信息未填写完整"
}
```

## 面向用户接口

### 用户是否已取号(超号5个亦视为已取号)

```
GET user/isUserInQueue/
```

后端返回

```
{
  "description": "用于判断用户是否已取号",
  "type": "object",
  "oneOf": [
    {
      "properties": {
        "isInQueue": {
          "description": "是否已取号",
          "enum": [ false ]
        }
      },
      "required": [ "isInQueue"]
    },
    {
      "properties": {
        "isInQueue": {
          "description": "是否已取号",
          "enum": [ true ]
        },
        "userPos": {
          "description": "用户取到的号码",
          "type": "number"
        },
        "curPos": {
          "description": "当前正叫的号",
          "type": "number"
        },
        "queueLength":{
          "description": "队列的总长度",
          "type": "number"
        },
        "avgServeTime":{
          "description": "平均每个人的服务时间",
          "type": "number"
        }
      },
      "required": [ "isInQueue" , "userPos" , "curPos" ,"queueLength" ,"avgServeTime"]
    }
  ]
}
```

### 队列信息

```
GET queueinfo.json
//注意避免缓存
```

```
{
  "description": "队列信息",
  "type": "object",
  "properties": {
    "curPos": {
      "description": "当前正叫的号",
      "type": "number"
    },
    "queueLength":{
      "description": "队列的总长度",
      "type": "number"
    },
    "avgServeTime":{
      "description": "平均每个人的服务时间",
      "type": "number"
    }
  },
  "required": [ "curPos" ,"queueLength" ,"avgWaitTime"]
}
```



### 用户须知页面

```
在用户点击确认后，引导用户跳转至 user/subscribeMsg/ 即可。完成操作后，后端将会引导用户跳转至报名信息填写页面
```

### 报名信息填写

```
POST user/register/

{
  "description": "用于前端返回用户注册信息",
  "type": "object",
  "properties": {
    "name": {
      "description": "姓名",
      "type": "string"
    },
    "dormitory": {
      "description": "宿舍",
      "type": "string",
      "pattern": "^(c|C)([1-9]|1[0-7])((\\s)*(-)(\\s)*|(\\s)+)[1-9][0-9][0-9]$"
    },
    "mobileNumber": {
      "description": "手机号",
      "type": "number",
      "pattern": "^1[0-9]{10}$"
    },
    "emailAddress": {
      "description": "邮箱地址",
      "type": "string",
      "pattern": "^([0-9A-Za-z\\-_\\.]+)@([0-9a-z]+\\.[a-z]{2,}(\\.[a-z]{2,})*)$"
    }
  },
  "required": [ "name", "dormitory", "mobileNumber", "emailAddress" ]
}
```

后端返回

```
//注意用户仅在过号>=5人之后后端才会接受重新取号
{
  "description": "返回成功取到号的信息",
  "type": "object",
  "properties": {
    "userPos": {
      "description": "用户取到的号码",
      "type": "number"
    },
    "curPos": {
      "description": "当前正叫的号",
      "type": "number"
    },
    "queueLength":{
      "description": "队列的总长度",
      "type": "number"
    },
    "avgServeTime":{
      "description": "平均每个人的服务时间",
      "type": "number"
    }
  },
  "required": ["userPos" , "curPos" ,"queueLength" ,"avgServeTime"]
}
```

